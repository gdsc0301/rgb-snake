var b=Object.defineProperty;var M=(a,t,e)=>t in a?b(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var i=(a,t,e)=>(M(a,typeof t!="symbol"?t+"":t,e),e),D=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var c=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)};var o=(a,t,e)=>(D(a,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const g of n.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&r(g)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class E{constructor(t,e,r,s){i(this,"x");i(this,"y");i(this,"size");i(this,"style");this.x=t,this.y=e,this.size=r,this.style=s}draw(t){t.fillStyle=this.style,t.fillRect(this.x+1,this.y+1,this.size-1,this.size-1)}}class P{constructor(t,e,r){i(this,"x");i(this,"y");i(this,"style");i(this,"parentPlayer");this.x=t,this.y=e,this.parentPlayer=r}setPosition(t){this.x=t.x,this.y=t.y}get position(){return{x:this.x,y:this.y}}draw(t){t.fillStyle=this.style;const e=new Path2D;e.rect(this.x+1,this.y+1,this.parentPlayer.partsSize-1,this.parentPlayer.partsSize-1),t.fill(e)}}const h={Up:"ArrowUp",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight"};var f,z,m,L,u,k;class I{constructor(t,e,r,s){c(this,f);c(this,m);c(this,u);i(this,"username");i(this,"x");i(this,"y");i(this,"direction");i(this,"game");i(this,"parts",[]);i(this,"partsSize",24);i(this,"tick",0);i(this,"maxSpeed",24);this.username=t,this.game=e,this.x=r,this.y=s,this.direction=h.Up,o(this,f,z).call(this)}setPosition(t,e){const r={x:this.x-t,y:this.y-e};this.x=t,this.y=e,this.parts.forEach(s=>{s.x+=r.x,s.y+=r.y})}update(){this.tick++,this.tick===Math.min(18,this.maxSpeed-Math.floor(this.parts.length/this.maxSpeed))&&(this.tick=0,o(this,u,k).call(this))}draw(t){this.parts.forEach((e,r)=>{e.style=this.game.GameColors[Object.keys(this.game.GameColors)[r]],e.draw(t)}),t.fillStyle=this.game.GameColors.five,t.fillText(`${this.username} | ${this.parts.length-3}`,this.x+this.partsSize+14,this.y-14)}isEating(t){if(t.x>=this.x&&t.x+t.size<=this.x+this.partsSize&&t.y>=this.y&&t.y+t.size<=this.y+this.partsSize){const e=this.parts[this.parts.length-1];this.parts.push(new P(e.x,e.y,this)),this.game.levelUp()}}}f=new WeakSet,z=function(){for(let t=0;t<3;t++)this.parts.push(new P(this.x,this.y+this.partsSize*t,this));window.addEventListener("keydown",t=>o(this,m,L).call(this,t))},m=new WeakSet,L=function(t){switch(t.key){case h.Up:this.direction=h.Up;break;case h.Down:this.direction=h.Down;break;case h.Left:console.log("GO TO LEFT"),this.direction=h.Left;break;case h.Right:this.direction=h.Right;break}},u=new WeakSet,k=function(){const t=this.partsSize;switch(this.direction){case h.Up:this.y-=t;break;case h.Down:this.y+=t;break;case h.Left:this.x-=t;break;case h.Right:this.x+=t;break}Math.round(this.x/this.partsSize)>this.game.canvasPropWidth&&(this.x=0),this.x<0&&(this.x=this.partsSize*this.game.canvasPropWidth),Math.round(this.y/this.partsSize)>this.game.canvasPropHeight&&(this.y=0),this.y<0&&(this.y=this.partsSize*this.game.canvasPropHeight);for(let e=this.parts.length-1;e>0;e--)this.parts[e].setPosition(this.parts[e-1].position);this.parts[0].setPosition({x:this.x,y:this.y})};var d,x,S,O,p,v;class C{constructor(t,e){c(this,d);c(this,S);c(this,p);i(this,"initialTime");i(this,"time");i(this,"score",0);i(this,"player");i(this,"food");i(this,"canvas");i(this,"ctx");i(this,"actorsSize");i(this,"gameLoop");i(this,"GameColors",{one:"#591202",two:"#F28157",three:"#BF4904",four:"#03A6A6",five:"#04D9D9"});i(this,"canvasProp");this.canvas=e,this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth-2,this.canvas.height=window.innerHeight-2,this.ctx=this.canvas.getContext("2d")}),this.actorsSize=24;const r={x:Math.round(Math.random()*this.canvasPropWidth)*this.actorsSize,y:Math.round(Math.random()*this.canvasPropHeight)*this.actorsSize};this.player=new I(t,this,r.x,r.y),o(this,p,v).call(this),this.initialTime=new Date}init(){return this.player?(this.gameLoop=setInterval(()=>this.update(),1e3/100),!0):!1}stop(){clearInterval(this.gameLoop)}update(){this.player.update(),this.player.isEating(this.food),this.time="Time: "+new Date(Date.now()-this.initialTime.getMilliseconds()).toLocaleString("en",{dateStyle:"medium"}),this.draw()}draw(){o(this,d,x).call(this,"black"),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),o(this,d,x).call(this,this.GameColors.three),this.ctx.fillText(this.time,16,16),this.player.draw(this.ctx),this.food.draw(this.ctx)}levelUp(){this.score++,o(this,p,v).call(this)}get canvasPropWidth(){return Math.round(this.canvas.width/this.actorsSize)}get canvasPropHeight(){return Math.round(this.canvas.height/this.actorsSize)}}d=new WeakSet,x=function(t){this.ctx.fillStyle=t},S=new WeakSet,O=function(t){this.ctx.strokeStyle=t},p=new WeakSet,v=function(){const t={x:Math.round(Math.random()*this.canvasPropWidth)*this.actorsSize,y:Math.round(Math.random()*this.canvasPropHeight)*this.actorsSize};this.food=new E(t.x,t.y,this.actorsSize,this.GameColors.five)};const l=document.createElement("canvas"),y=document.getElementById("usernameForm");let w;function G(){l.width=window.innerWidth-2,l.height=window.innerHeight-2,l.tabIndex="1",document.body.appendChild(l),y.addEventListener("submit",a=>{a.preventDefault();const t=a.target.elements[0].value;w=new C(t,l),window.addEventListener("keydown",e=>{e.key==="Escape"&&w.stop()}),w.init()?(console.log("Init done"),l.focus(),y.elements[0].classList.remove("invalid"),y.parentElement.classList.add("done")):(console.error("Init failed"),y.elements[0].classList.add("invalid"))})}G();
